{
	"name": "PayPal Form",
	"serverCode": "if(!postvalue(\"hash\") || postvalue(\"pdfjson\"))\n\treturn;\n\t\n$rs = DB::Query(\"select * from invoices where hash='\".postvalue(\"hash\").\"'\");\n$data = $rs->fetchAssoc();\nif ($data[\"status\"] == \"paid\")\n\treturn;\n\n\n$res = \"<a href=# onclick=\\\"$('#ppform').submit();return false;\\\" id=imgpp><img src='images/paypal.png' width=200px /></a>\";\n$protocol = ((!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] != 'off') || $_SERVER['SERVER_PORT'] == 443) ? \"https://\" : \"http://\";\n$url = $protocol . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];\n$p = strpos($url,\"invoices\");\n$url_ipn = substr($url,0,$p);\n\n$rs = DB::Query(\"select * from invsettings\");\n$data = $rs->fetchAssoc();\n$email = $data[\"ppEmail\"];\n$curr = $data[\"ppCurrency\"];\n$sandbox = \"\";\nif($data[\"ppSandbox\"])\n\t$sandbox = \"sandbox.\";\n\n$rs = DB::Query(\"select * from invoices where hash='\".postvalue(\"hash\").\"'\");\n$data = $rs->fetchAssoc();\n$inv = $data[\"id\"];\n$res.= \"<span style='padding-left:20px'><form action='https://www.\".$sandbox.\"paypal.com/cgi-bin/webscr' method='post' id=ppform>\";\n$res.= \"<input type='hidden' name='cmd' value='_cart' />\";\n$res.= \"<input type='hidden' name='upload' value='1' />\";\n$res.= \"<input type='hidden' name='business' value='\".$email.\"' />\";\n$res.= \"<input type='hidden' name='item_number_1' value='\".postvalue(\"hash\").\"' />\";\n$rs2 = DB::Query(\"select * from invoicedetails where id_invoice='\".$inv.\"'\");\n$i=1;\nwhile($data2 = $rs2->fetchAssoc()){\n\t\t$res.= \"<input type='hidden' name='item_name_\".$i.\"' value='\".$data2[\"item\"].\"' />\";\n\t\t$res.= \"<input type='hidden' name='quantity_\".$i.\"' value='\".$data2[\"quantity\"].\"' />\";\n\t\t$res.= \"<input type='hidden' name='amount_\".$i.\"' value='\".($data2[\"price\"] + $data2[\"price\"]*$data[\"tax\"]/100).\"' />\";\n\t\t$i++;\n}\n$res.= \"<input type='hidden' name='no_shipping' value='1' />\";\n\t$res.= \"<input type='hidden' name='cancel_return' value='\".$url.\"' />\";\n\t$res.= \"<input type='hidden' name='return' value='\".$url.\"&page=view1&paypal=ok' />\";\n\t$res.= \"<input type='hidden' name='notify_url' value='\".$url_ipn.\"ipn.php' />\";\n\t$res.= \"<input type='hidden' name='currency_code' value='\".$curr.\"' />\";\n $res.= \"</form></span>\";\nif($email && $curr)\necho $res;"
}