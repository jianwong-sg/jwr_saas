{
	"name": "PayCart",
	"serverCode": "if(!postvalue(\"hash\") || postvalue(\"pdfjson\"))\n\treturn;\n\n$rs = DB::Query(\"select * from invoices where hash='\".postvalue(\"hash\").\"'\");\n$data = $rs->fetchAssoc();\nif ($data[\"status\"] == \"paid\")\n\treturn;\n$invid = $data[\"id\"];\n$rss = DB::Query(\"select * from invoicedetails where id_invoice=\".$invid);\n$c = 0;\nwhile($ddata = $rss->fetchAssoc())\n\t$c+=$ddata[\"quantity\"];\n\n\n$rss = DB::Query(\"select * from invsettings\");\n$ddata = $rss->fetchAssoc();\n$cur = $ddata[\"ppCurrency\"];\n$pubkey = $ddata[\"stripePKey\"];\n$seckey = $ddata[\"stripeSKey\"];\n$labelbutton = $ddata[\"stripeLabel\"];\n$labelbutton = str_replace(\"{cur}\",$cur,$labelbutton);\n$labelbutton = str_replace(\"{total}\",str_format_number($data[\"total\"],2),$labelbutton);\n//Pay&nbsp;<span style='position:relative;top:-2px;'>\".str_format_number($data[\"total\"],2).\"</span>&nbsp;\".$cur.\"</a>\n\nif($pubkey && $seckey){\necho \"<a type='button' class='btn btn-primary' id='stripeButton'>\".$labelbutton.\"</a>&nbsp;<img src='images/paycard.png' width=150px />\";\necho \"<script>\";\necho \"$('#stripeButton').click(function(){\";\necho \"var amount = parseFloat(\".($data[\"total\"]*100).\");\";\necho \"StripeCheckout.open({\";\necho \"key:         '\" . $pubkey .\"',\";\necho \"email: '\".$data[\"buyer_email\"].\"',\";\necho \"address:     false,\";\necho \"amount:      amount,\";\necho \"currency:      '\".$cur.\"',\";\necho \"name:        '\".GetCustomLabel(\"invoice\").\"# \".$data[\"invoice_number\"].\"',\";\necho \"description: '\".str_replace(\"'\",\"\\\\'\",$data[\"buyer_info\"]).\"',\";\necho \"panelLabel:  '\".GetCustomLabel(\"checkout\").\" (\".$c.\" items)',\";\necho \"token:       charge_stripe\";\necho \"});\";\necho \"return false;\";\necho \"});\";\necho \"</script>\";\n}"
}