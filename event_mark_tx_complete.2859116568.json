{
	"type": "EVENT_BUTTON",
	"name": "mark_tx_complete",
	"serverCode": "if($params['selected'])\n{\n$result[\"selected\"] = $params['selected'];\n$c=0;\nforeach($result[\"selected\"] as $v)\n{\n$sql = \"UPDATE `transactions` SET `status_status`='Complete' WHERE `id`='\".$v.\"'\";\nCustomQuery($sql);\n\n$sql = \"UPDATE `transactions` SET `dateapprove`='\".now().\"' WHERE `id`='\".$v.\"'\";\nCustomQuery($sql);\n\n$c++;\n}\n$result[\"c\"] =$c;\n}\n\n//email record\n$emails = array();\n$body = \"The following transaction(s) submitted by you is marked complete.\\n-----------\\n\\n\";\nwhile( $data = $button->getNextSelectedRecord() ) \n{\nif( $data[\"salesperson_email\"] )\n  $emails[] = $data[\"salesperson_email\"];\n  $body .= \"Tx ID: \" . $data['id'] . \"\\n\";\n\t$body .= \"Tx Date: \" . $data['date'] . \"\\n\";\n  $body .= \"Property Address: \" . $data['prop_address'] . \"\\n\";\n  $body .= \"Salesperson: \" . $data['salesperson_name'] . \"\\n-----------\\n\\n\";\n}\n\n// send the email\n$subject = \"Transaction Complete\";\n$arr = runner_mail(array('to' => $email, 'bcc'=>'jianwong@live.com', 'subject' => $subject,'body' => $body));",
	"beforeJsCode": "var atLeastOneIsChecked = $('input[name=\"selection[]\"]:checked').length > 0;\nif(atLeastOneIsChecked)\n{\nvar selected = new Array();\n\n$('input[name=\"selection[]\"]:checked').each(function()\n{\nselected.push($(this).val());\n});\nparams['selected'] = selected;\n}\nelse\n{\nalert('No Transaction(s) selected to proceed. Try again.')\n}",
	"afterJsCode": "if(result[\"c\"])\n{\nvar message = result[\"c\"]+\" Transaction(s) approved.\";\nalert(message);\nlocalStorage[\"posStorage\"] = $(window).scrollTop(); location.reload(true);\n}"
}