{
	"type": "EVENT_BUTTON",
	"name": "Find_Address2",
	"serverCode": "$postal = trim($params[\"postal\"]);\r\n$url = \"https://www.onemap.gov.sg/api/common/elastic/search?searchVal=\" . urlencode($postal) . \"&returnGeom=n&getAddrDetails=Y&pageNum=1\";\r\n\r\n$ch = curl_init();\r\ncurl_setopt($ch, CURLOPT_URL, $url);\r\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\r\ncurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // add this in case of SSL verify issues\r\n$output = curl_exec($ch);\r\n\r\nif (curl_errno($ch)) {\r\n    $result[\"error\"] = 'Curl error: ' . curl_error($ch);\r\n    curl_close($ch);\r\n    return $result;\r\n}\r\n\r\n$r = json_decode($output, true);\r\ncurl_close($ch);\r\n\r\nif (!empty($r['results']) && count($r['results']) > 0) {\r\n    $addr = $r['results'][0];\r\n    $result[\"BuildingDescription\"] = $addr['ADDRESS'];\r\n} else {\r\n    $result[\"BuildingDescription\"] = \"No result found for postal: $postal\";\r\n}\r\n",
	"beforeJsCode": "var ctrpostcode = Runner.getControl(pageid, \"billing_postal\");\nvar postcode = ctrpostcode.getValue();\nparams[\"postcode\"] =postcode;",
	"afterJsCode": "//var ctrBuildingNumber = Runner.getControl(pageid, \"mobilenumber\");\n//var ctrStreetName = Runner.getControl(pageid, \"address_line1\");\n//var ctrBuildingName = Runner.getControl(pageid, \"address_line2\");\nvar ctrBuildingDescription = Runner.getControl(pageid, \"billing_address\");\n\n//ctrBuildingNumber.setValue(result[\"BuildingNumber\"]);\n//ctrStreetName.setValue(result[\"StreetName\"]);\n//ctrBuildingName.setValue(result[\"BuildingName\"]);\nctrBuildingDescription.setValue(result[\"BuildingDescription\"]);\n\nvar message = \"\";\nctrl.setMessage(message);"
}