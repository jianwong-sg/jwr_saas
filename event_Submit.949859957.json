{
	"type": "EVENT_BUTTON",
	"name": "Submit",
	"serverCode": "//update transactions\nif($params['selected'])\n{\n$result[\"selected\"] = $params['selected'];\n$c=0;\nforeach($result[\"selected\"] as $v)\n{\n$sql = \"UPDATE `transactions` SET `status_status`='Pending Approval' WHERE `id`='\".$v.\"'\";\nCustomQuery($sql);\n\n$sql = \"UPDATE `transactions` SET `datesubmit`='\".now().\"' WHERE `id`='\".$v.\"'\";\nCustomQuery($sql);\n\n$c++;\n}\n$result[\"c\"] =$c;\n}\n\n//email record\n\n$body = \"The following\ntransaction(s) submitted for approval.\\n-----------\\n\\n\";\n\nwhile( $data = $button->getNextSelectedRecord() ) \n{\n\t$body .= \"Tx ID: \" . $data['id'] . \"\\n\";\n\t$body .= \"Tx Date: \" . $data['date'] . \"\\n\";\n  $body .= \"Property Address: \" . $data['prop_address'] . \"\\n\";\n  $body .= \"Salesperson: \" . $data['salesperson_name'] . \"\\n-----------\\n\\n\";\n}\n\n// send the email\n$email = \"jian.sg@gmail.com\";\n$subject = \"Transaction pending approval\";\n$arr = runner_mail(array('to' => $email, 'bcc'=>'jianwong@ymail.com', 'subject' => $subject,'body' => $body));",
	"beforeJsCode": "/*\nvar atLeastOneIsChecked = $('input[name=\"selection[]\"]:checked').length > 0;\nif(atLeastOneIsChecked)\n{\nvar selected = new Array();\n\n$('input[name=\"selection[]\"]:checked').each(function()\n{\nselected.push($(this).val());\n});\nparams['selected'] = selected;\n}\nelse\n{\nalert('Unable to proceed. Please select Transaction(s) and try again.')\n}\n*/\n\nvar atLeastOneIsChecked = $('input[name=\"selection[]\"]:checked').length > 0;\n\nif (atLeastOneIsChecked) {\n    // Using array literal notation [] instead of new Array()\n    var selected = [];\n    \n    // Using map() instead of each() for cleaner code\n    selected = $('input[name=\"selection[]\"]:checked').map(function() {\n        return $(this).val();\n    }).get();\n    \n    params['selected'] = selected;\n} else {\n    alert('Unable to proceed. Please select Transaction(s) and try again.');\n    return false; // Added to prevent further execution\n}",
	"afterJsCode": "if(result[\"c\"])\n{\nvar message = result[\"c\"] + \" Selected Transaction(s) successfully submitted and now pending approval.\";\nalert(message);\nlocalStorage[\"posStorage\"] = $(window).scrollTop(); location.reload(true);\n}"
}