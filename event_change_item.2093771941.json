{
	"type": "EVENT_FIELD",
	"name": "change_item",
	"serverCode": "$rs = DB::Query(\"select * from invitems where title='\".str_replace(\"'\",\"''\",$params[\"value\"]).\"'\");\n$data = $rs->fetchAssoc();\n$result[\"price\"] = $data[\"price\"];\n$result[\"rate\"] = $data[\"rate\"];\n$result[\"item_tax\"] = 0;\nif( $params[\"invoice_type\"] === GetCustomLabel(\"option_tax_percentage_standard_and_reduced\")){\n\tif($result[\"rate\"] === GetCustomLabel(\"standard\") || $result[\"rate\"] === \"\" || is_null($result[\"rate\"]) ) {\n\t\t$result[\"item_tax\"] = $params[\"standard_tax_percentage\"];\n\t}\n\tif($result[\"rate\"] === GetCustomLabel(\"reduced\")) {\n\t\t$result[\"item_tax\"] = $params[\"reduced_tax_percentage\"];\n\t}\n}\nif( $params[\"invoice_type\"] === GetCustomLabel(\"option_standard_tax_percentage\")){\n\t$result[\"item_tax\"] = $params[\"standard_tax_percentage\"];\n}\nif( $params[\"invoice_type\"] === GetCustomLabel(\"option_reduced_tax_percentage\")){\n\t$result[\"item_tax\"] = $params[\"reduced_tax_percentage\"];\n}\n\n\nglobal $locale_info;\n$currency = array();\n$currency[\"SCURRENCY\"] =  $locale_info[\"LOCALE_SCURRENCY\"];\n$currency[\"INEGCURR\"] = $locale_info[\"LOCALE_INEGCURR\"];\n$currency[\"ICURRENCY\"] = $locale_info[\"LOCALE_ICURRENCY\"];\n$result[\"currency\"] = $currency;",
	"beforeJsCode": "params[\"value\"] = this.getValue();\nparams[\"standard_tax_percentage\"] = pageObj.masterPageObj.proxy[\"standard_tax_percentage\"];\nparams[\"reduced_tax_percentage\"] = pageObj.masterPageObj.proxy[\"reduced_tax_percentage\"];\nparams[\"invoice_type\"] = pageObj.masterPageObj.proxy[\"invoice_type\"];\nparams[\"template_scheme\"] = pageObj.masterPageObj.proxy[\"template_scheme\"];",
	"afterJsCode": "var row = pageObj.inlineAdd.getRowById(pageid);\nrow = new Runner.AjaxRow(pageObj, row);\nvar quantityCloseness = 0;\nvar ctrlPrice = Runner.getControl(pageid, \"price\");\nvar currency = result[\"currency\"];\nvar price = result[\"price\"],\n    quantity = row.getFieldValue('quantity').replace(/[^\\d.]/g, \"\"),\n    taxIndividually = row.getFieldValue(\"item_tax\");\nvar ctrl_item_tax = Runner.getControl(pageid, \"item_tax\");\nif (pageObj.proxy[\"template_scheme\"] == 2) {\n    taxIndividually = result[\"item_tax\"];\n\n    ctrl_item_tax.setValue(result[\"item_tax\"]);\n}\nelse{\n    ctrl_item_tax.setValue(0);\n}\nprice = price.toString().replace(\".\",Runner.locale_info[\"LOCALE_SMONDECIMALSEP\"]); \nctrlPrice.setValue(price);\n\nrow.setFieldText(\"subttl_individually\", Runner.Invoice.calculateTotals(price, quantity, quantityCloseness, currency));\nrow.setFieldText('total', Runner.Invoice.calculateTotals(price, quantity, quantityCloseness, currency, taxIndividually));\nRunner.Invoice.setGlobalTotals(currency);"
}